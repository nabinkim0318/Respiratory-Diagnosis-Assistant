<!DOCTYPE html>
<html>
<head>
    <title>Search Results</title>
    <script>
        // Function to fetch and display content of text files
        async function fetchText(url, elementId) {
            const response = await fetch(url);
            const text = await response.text();
            document.getElementById(elementId).innerText = text;
        }
    </script>
</head>
<body>
    <h1>Search Results</h1>

    {% if search_results %}
        <div class="results">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Patient ID</th>
                        <th>Diagnosis Name</th>
                        <th>Recording Index</th>
                        <th>Chest Location</th>
                        <th>Acquisition Model</th>
                        <th>Recording Equipment</th>
                        <th>Annotation File</th>
                        <th>Respiratory Cycles</th>
                        <th>Sound File</th>
                        <th>Similarity Score (if applicable)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in search_results %}
                    <tr>
                        <td>{{ result.patient_number }}</td>
                        <td>{{ result.diagnosis_name }}</td>
                        <td>{{ result.recording_index }}</td>
                        <td>{{ result.chest_location }}</td>
                        <td>{{ result.acquisition_model }}</td>
                        <td>{{ result.recording_equipment }}</td>
                        <td><a href="#" onclick="fetchText('{{ result.annotation_file }}', 'text-content-{{ forloop.counter }}'); return false;">View Annotation</a>
                            <div id="text-content-{{ forloop.counter }}" style="white-space: pre-wrap;"></div>
                        </td>
                        <td>{{ result.respiratory_cycles }}</td>
                        <td>
                            <audio controls>
                                <source src="{{ result.audio_file }}" type="audio/wav">
                                Your browser does not support the audio element.
                            </audio>
                        </td>
                        <td>
                            {% if result.similarity_score %}
                            {{ result.similarity_score|floatformat:2 }}
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No results found. Please try another search.</p>
    {% endif %}

</body>
</html>